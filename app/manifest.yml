app:
  id: ari:cloud:ecosystem::app/23392b90-4271-4239-98ca-a3e96c663cbb

modules:
  macro:
    - key: mermaid-diagrams-viewer-bitbucket
      resource: custom-ui
      resolver:
        function: bitbucket-resolver
      title: Diagrams viewer - Bitbucket
      description: Renders mermaid diagrams from file on Bitbucket
      config:
        function: config-bitbucket
    - key: mermaid-diagrams-viewer-confluence
      resource: custom-ui
      resolver:
        function: confluence-resolver
      title: Diagrams viewer - Confluence
      description: Renders mermaid diagrams code block on current page
      config:
        function: config-confluence

  function:
    - key: bitbucket-resolver
      handler: bitbucket.run
      providers:
        auth:
          - bitbucket
    - key: config-bitbucket
      handler: config.bitbucket

    - key: confluence-resolver
      handler: confluence.run
    - key: config-confluence
      handler: config.confluence

resources:
  - key: custom-ui
    path: build/custom-ui

remotes:
  - key: bitbucket
    baseUrl: https://bitbucket.org
  - key: bitbucket-api
    baseUrl: https://api.bitbucket.org

permissions:
  scopes:
    - 'read:page:confluence'
  content:
    styles:
      - 'unsafe-inline'
  external:
    fetch:
      backend:
        - https://bitbucket.org
        - https://api.bitbucket.org

providers:
  auth:
    - key: bitbucket
      name: Bitbucket
      scopes:
        - repository
        - snippet
        - account
      type: oauth2
      clientId: paMEDYRZvXwGmwEWmD
      remotes:
        - bitbucket
        - bitbucket-api
      bearerMethod: authorization-header
      actions:
        authorization:
          remote: bitbucket
          path: /site/oauth2/authorize
        exchange:
          remote: bitbucket
          path: /site/oauth2/access_token
        retrieveProfile:
          remote: bitbucket-api
          path: /2.0/user
          resolvers:
            id: uuid
            displayName: display_name
            avatarUrl: links.avatar.href
